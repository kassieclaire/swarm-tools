{"id":"opencode-swarm-monorepo-lf2p4u-mjbxccwcrmr","title":"Add automatic legacy memory migration on first use","description":"## Problem\n\nThe migration from standalone semantic-memory MCP to embedded memory is NOT automatic:\n- Users must manually call `migrateLegacyMemories()`\n- `swarm setup` doesn't check for or offer migration\n- Plugin startup doesn't auto-detect legacy data\n\n## Current State\n\n- Migration tool exists: `packages/swarm-mail/src/memory/migrate-legacy.ts`\n- 10 unit tests for the migration logic\n- But NO integration into the user flow\n\n## Solution\n\n### Option A: Auto-migrate on first memory operation\nWhen `createMemoryAdapter()` is called:\n1. Check if `~/.semantic-memory/memory` exists\n2. Check if target has 0 memories\n3. If both true, auto-migrate with progress logging\n4. Store migration marker to prevent re-checking\n\n### Option B: CLI integration\nAdd to `swarm setup`:\n1. Check for legacy database\n2. Prompt user: \"Found legacy semantic-memory data. Migrate now?\"\n3. Run migration with progress bar\n\n### Option C: Both\n- CLI offers migration during setup\n- Plugin auto-migrates if user skipped CLI\n\n## Acceptance Criteria\n\n1. User with `~/.semantic-memory/memory` runs `swarm setup` → offered migration\n2. User who skips CLI migration → auto-migrated on first `semantic-memory_store`\n3. Migration is idempotent (safe to run multiple times)\n4. Progress is visible (not silent)\n5. Integration tests prove the flow works end-to-end\n\n## References\n- Migration tool: `packages/swarm-mail/src/memory/migrate-legacy.ts`\n- CLI: `packages/opencode-swarm-plugin/bin/swarm.ts`\n- Memory adapter: `packages/opencode-swarm-plugin/src/memory.ts`","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-18T21:00:06.348Z","updated_at":"2025-12-18T21:28:01.597Z","closed_at":"2025-12-18T21:28:01.597Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbxj67vqil","title":"Add automatic legacy memory migration on first use","description":"Implement seamless migration from standalone semantic-memory MCP to embedded memory. CLI offers migration during setup, plugin auto-migrates if user skipped CLI. Parent: mjbxccwcrmr","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-18T21:05:24.283Z","updated_at":"2025-12-18T21:27:58.829Z","closed_at":"2025-12-18T21:27:58.829Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbxj685vro","title":"Add migration prompt to swarm setup CLI","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T21:05:24.293Z","updated_at":"2025-12-18T21:16:53.896Z","closed_at":"2025-12-18T21:16:53.896Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbxj67vqil","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbxj68arw3","title":"Add auto-migration to createMemoryAdapter","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T21:05:24.298Z","updated_at":"2025-12-18T21:16:55.146Z","closed_at":"2025-12-18T21:16:55.146Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbxj67vqil","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbxj68dmtb","title":"Add integration tests for migration flow","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T21:05:24.301Z","updated_at":"2025-12-18T21:27:51.812Z","closed_at":"2025-12-18T21:27:51.812Z","parent_id":"opencode-swarm-monorepo-lf2p4u-mjbxj67vqil","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjbxyp1z9ft","title":"Remove legacy semantic-memory MCP from OpenCode config during setup","description":"## Problem\n\nUsers with the standalone semantic-memory MCP server configured will have BOTH:\n- Old MCP tools (from ~/.config/opencode/config.json mcpServers)\n- New embedded tools (from opencode-swarm-plugin)\n\nThis causes tool name conflicts and confusion.\n\n## Solution\n\nIn `swarm setup`, after the memory migration prompt:\n1. Check if `~/.config/opencode/config.json` exists\n2. Parse it and look for `mcpServers.semantic-memory`\n3. If found, prompt: \"Found legacy semantic-memory MCP server. Remove it? (now embedded in plugin)\"\n4. If yes, remove the entry and write back the config\n5. Show: \"Removed semantic-memory from MCP servers. Tools are now provided by the plugin.\"\n\n## Implementation\n\n```typescript\n// In setup(), after memory migration\nconst configPath = join(homedir(), '.config', 'opencode', 'config.json');\nif (existsSync(configPath)) {\n  const config = JSON.parse(readFileSync(configPath, 'utf-8'));\n  if (config.mcpServers?.['semantic-memory']) {\n    const remove = await p.confirm({\n      message: 'Found legacy semantic-memory MCP server. Remove it? (now embedded in plugin)',\n      initialValue: true,\n    });\n    if (remove) {\n      delete config.mcpServers['semantic-memory'];\n      writeFileSync(configPath, JSON.stringify(config, null, 2));\n      p.log.success('Removed semantic-memory from MCP servers');\n    }\n  }\n}\n```\n\n## Parent\nEpic: mjbxj67vqil","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T21:17:28.535Z","updated_at":"2025-12-18T21:27:53.958Z","closed_at":"2025-12-18T21:27:53.958Z","dependencies":[],"labels":[],"comments":[]}